---
tags:
  - 计算机组成原理
---
# 概念
## 存储周期/读写周期
- 连续两次存取操作所需要的最小时间间隔
- 存取时间+恢复时间=存储周期
# 存储器的分类
## 按照存储介质分类
### 半导体存储器
主存、cache（断电数据会丢失）
### 磁性材料存储器
磁盘、磁带、软盘
### 光介质存储器
光盘
## 存取方式分类
### 随机存取存储器 RAM、Random Access Memory
读写任何一个存储单元所需的时间都相同，与存储单元所在物理位置无关
内存条、U盘等
### 顺序存取存储器 SAM、Sequential Access Memory
读写一个存储单元所需时间取决于存储单元所在的物理位置（磁带）
### 直接存取存储器 DAM、Direct Access Memory
既有随机存取特性，也有顺序存取特性。先直接选取信息所在区域，然后按顺序方式存取。(机械磁盘)
### 相联存储器 Associative Memory
可以按照内容检索到存储位置进行读写。
快表：内存逻辑地址转物理地址的工具
## 信息的可更改性
### 读写存储器 Read/Write Memory
可读、可写。有磁盘、内存、Cache
### 只读存储器 Read Only Memory
只读、不可写。(不是完全不能写，写比较读更费劲)
音乐专辑CD-ROM
# 层次化存储器的基本结构
速度从高到低
- 寄存器
- 高速缓存（Cache）
- 主存储器（主存、内存）
- 辅助存储器（外存）
# 半导体随机存取存储器
## 存储器组成
*存储矩阵*是由一个一个的存储元构成；
*译码驱动电路*分为*译码器*和*驱动器*，译码器会输出某一条线路的高电平信号，驱动器是为了保证译码器输出的高电平稳定可靠的，可以理解为将电信号放大的部件。
*读写电路*是连通存储元的电路
*地址线*：用来读取和写入数据，接收地址信息，通常是CPU通过地址总线传来的,决定寻址范围
*数据线*：实现数据的传输，其位数与芯片可读出或写入的数据位数有关
*片选线*：传输芯片选择信号或者芯片使能信号，用来选择存储芯片
*读写控制线*：可以一条，可以两条
## 1. SRAM存储器（cache）

## 2. DRAM存储器（主存）
破坏性读出，需要刷新
### DRAM的地址复用技术
- 先传送行地址，后传送列地址、分两次传送
- 可以减少地址线、地址引脚减半
- 比如4M\*8位芯片，本来需要22根地址线，复用后只需要11根
## 3. Flash 存储器
- 一种非易失性存储器，断电后数据也不会丢失。
- 允许多次擦写操作，广泛用于固态硬盘、USB闪存驱动器、存储卡等。
- 与传统的ROM相比，Flash存储器的一个主要优势是它可以进行擦除和重新编程。
- 需要有至少一个**物理块（Block）** 作为交换块使用，因为写操作必须是先擦除，然后才能写入数据，而擦除的最小单位是一个物理块，交换块用来临时存储不需要被擦除的数据
# 主存储器
## 1.DRAM 芯片和内存条
### 双端口RAM
优化多核CPU访问一根内存条的速度
只能同时读，两个端口同时写，一个读一个写都不行
## 2.多模块存储器
### 多模块存储器
#### 单体多字存储器
- 每个存储单元存储m个字
- 总线宽度m个字
- 一次并行读出m个字    
#### 多体并行存储器（双通道内存）
- 高位交叉编制
- 低位交叉编制
- 每个存储周期读出m个字
## 3.主存和 CPU 之间的连接
### 位扩展法
CPU数据项线和存储信息数据位数不一致(一般是CPU的数据线大/多)
### 字扩展法
#### 线选法
没有使用译码器，浪费了控制/地址线
4个对应0001/0010/0100/1000
#### 片选法
使用译码器，两位对应四种（00/01/10/11）
### 理解(例 8K\*1位)
位扩展8K\*8位,增加数据线
字扩展16K\*1位,增加地址线
# 外部存储器
## 1.磁盘存储器
### 组成
驱动器（机械结构）
控制器（电路）
### 磁盘地址结构
柱面号->盘面号->扇区号
### 存取时间
寻道时间+旋转延迟+传输时间
### 磁盘阵列
RAID0 无冗余校验，类比低位交叉编址
RAID1 镜像一份
RAID2 4bit信息+3bit海明校验
RAID3 位交叉奇偶校验
RAID4 块交叉奇偶校验
RAID5 无独立校验的奇偶校验
## 2.固态硬盘(SSD)
### 组成
主控--闪存--固件算法
### 主控
使用映射表访问flash颗粒，类似页表访问页
### 固件算法
耗损平衡，错误校正码(ECC)，坏块管理、垃圾回收算法等
因为删除时是逻辑删除（将映射表映射删除），所以SSD快满时，需要将多个半满的块整合成一个块才能空出块给用户写入数据，这时候写速度会变慢
# 高速缓冲存储器(Cache)
## 1.Cache 的基本原理
物理地址分为标记，行号，块内偏移
1. 先通过行号找到对应cache行
2. 然后通过比较器比较标记tag是否相同，不相同导致cache缺失
3. 如果相同直接从cache行中的数据块中读出内容，缺失需要读主存，将主存块放入cache后再次访问cache
## 2.Cache 和主存之间的映射方式
### 全相联映射
主存块可以放在Cache的任意位置
主存地址表示：标记+块内地址
标记就是在主存中标记出一块，比如主存4096块，就需要12位标记出特定的一块
### 直接映射
只能放到一个特定的位置
Cache 号：主存块号%Cache总块数
主存地址表示：（标记+Cache 号）+块内地址
### 组相联映射
Cache块分为若干组，组号=主存块号 ％分组数
主存地址表示：标记+组号+（组内槽号）+块内地址
n路组相联就是n个块为一组，分成（cache总块数/n）个组
## 3.Cache 中主存块的替换算法
### 随机算法（RAND）
### 先进先出（FIFO）
- 实现：按照行号轮流替换
### 近期最少使用（LRU）
- 手算：往前看，哪个最后出现替换哪个
- 实现：给cache块添加计数器，替换计数器最大的 *需要一个替换控制位*
	- 命中时，所命中的行的计数器清零，比其低（只需找最大，这样可减少操作）的计数器加1，其余不变; 
	- 未命中且还有空闲行时，新装入的行的计数器置0，其余非空闲行全加1; 
	- 未命中且无空闲行时，计数值最大的行的信息块被淘汰，新装行的块的计数器置0，其余全加1
### 最不经常使用算法 (LFU)
- 每被访问一次计数器+1。需要替换时，选择计数器最小的一行
- 缺点：曾经被经常访问的主存块在未来不一定会用到，但计数器已经很大了，未来可能很久不会淘汰
## 4.Cache 写策略
Cache 仅存储主存中的数据副本，此副本更改后如何写回主存，多级cache可以使用不同的策略
### 写命中（写的块在cache里）
#### 写回法
只修改Cache的内容，而不立即写入主存，只有当此块被换出时才写回主存
添加脏位，标记是否修改过
#### 全写法
当CPU对Cache写命中时，必须把数据同时写入Cache和主存
Cache和主存之间添加FIFO写缓冲
写操作频繁，可能会发生写缓冲饱和而阻塞
### 写不命中（写的块不在cache里）
#### 写分配法
主存中的块调入Cache，在Cache中修改。通常搭配写回法使用。
#### 非写分配法
主存中的块不调入Cache，直接在主存中修改。通常搭配全写法使用。
# 虚拟存储器
## 1.虚拟存储器的基本概念
程序不用全部放入内存，只需将用到的放到驻留集中
## 2.页式虚拟存储器
基本原理，页表，地址转换，TLB(快表)。
## 3.段式虚拟存储器的基本原理
## 4.段页式虚拟存储器的基本原理