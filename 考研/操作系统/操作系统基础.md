---
tags:
  - 操作系统
---
# 操作系统的基本概念
# 操作系统发展历程
1. **手工操作阶段**：依赖人工操作计算机。
2. **批处理阶段**：
    - **单道批处理**：一次只能处理一个任务。
    - **多道批处理**：同时处理多个任务
    - 操作系统在此时诞生，支持在使用I/O时进行其他任务计算。
1. **分时操作系统**：
    - **时间片轮转**：为各个用户分配时间片，实现多任务并发。
    - **优点**：提供人机交互。
    - **缺点**：不能优先处理紧急任务。
2. **实时操作系统**：
    - **优先响应紧急任务**。
    - **分类**：
        - **硬实时系统**：必须严格按时完成任务。
        - **软实时系统**：能接受偶尔延迟，时间控制要求不那么严格。
# 程序运行环境
## 1.CPU 运行模式
通过PSW寄存器里面的值判断是 内核模式 还是 用户模式。
- 内核态-> 用户态
	- 一条修改PSW的特权指令
- 用户态-> 内核态
	- 中断引起，硬件自动完成
## 2.中断和异常的处理
[总线和输入，输出系统 \> 2.程序中断方式](../计算机组成原理/总线和输入，输出系统.md#2.程序中断方式)
## 3.系统调用
1. **用户应用发起调用**：用户程序通过库函数（如 C 语言中的 `write`）准备参数，write系统调用需要 3 个参数：
	- 文件描述符,标准输出文件描述符为 1 ；
	- 写入内容(缓冲区)地址；
	- 写入内容长度(字节数)；
	然后发出软中断（如 `int 0x80`）以请求内核服务。
2. **内核处理请求**：接收到中断后，内核切换到内核模式，执行相应的系统调用服务例程（如 `sys_write`），同时要将参数复制到内核态保证安全。
3. **返回结果**：系统调用完成后，结果被返回给用户应用，CPU 切换回用户模式。
4. 用户程序继续执行，如果是exit系统调用，会使用户程序终止
## 4.程序的链接与装入
## 链接
- **静态链接**：程序运行前完成链接，生成完整的可执行文件。
- **装入时动态链接**：在程序装入内存时边装入边链接。
- **运行时动态链接**：程序执行时按需链接目标模块，便于修改和共享。
## 装入
- **绝对装入**：程序直接指明物理地址，适用于单道程序环境。
- **可重定位装入**：装入时修改地址（静态重定位），无法在运行时移动。
- **动态运行时装入**：程序运行时动态调整地址，支持内存分配和程序段共享。
## 5.程序运行时的内存映像与地址空间
# 操作系统结构
内核就是运行在内核态的实现功能的程序
## 1. **大内核**：
- **定义**：所有操作系统功能都作为系统内核，运行在核心态。
- **优点**：高性能，模块间可直接调用。
- **缺点**：内核庞大且复杂，难以维护；某模块出错可能导致系统崩溃。
## 2. **微内核**
- **定义**：只保留最基本的功能在内核中。
- **优点**：内核小、易维护，可靠性高；模块出错不影响整个系统。
- **缺点**：性能低，频繁切换用户态/核心态，模块间只能通过消息传递通信。
## 3. **分层结构**
- **定义**：操作系统分为若干层，依次调用下层功能。
- **优点**：便于调试、验证，易于扩展和维护。
- **缺点**：层次划分困难，效率较差。
## 4. **模块化**
- **定义**：内核=主模块+可加载内核模块，主模块只负责核心功能支持动态加载新模块。
- **优点**：模块间逻辑清晰，支持动态加载，效率高。
- **缺点**：模块间接口不总是合理，依赖关系增加调试难度。
## 5. **外核**
- **定义**：内核负责基本功能，外核负责硬件资源分配和安全性保障。
- **优点**：直接分配硬件资源，提高效率。
- **缺点**：系统一致性差，复杂度增加。
# 操作系统引导
1. 激活CPU，boot将PC值设为bios程序的入口
2. 进行硬件自检
3. 读取硬盘，加载主引导记录（MBR）（硬盘的第一份扇区）
4. 扫描硬盘分区表
5. 加载活动分区的分区引导记录（PBR）（分区的第一份扇区）
6. 执行启动管理器
	- 启动管理器根据配置文件（如Windows中的BCD、XP中的boot.ini）显示操作系统选择菜单，用户选择后，控制权交给操作系统初始化程序。
7. 加载操作系统
# 虚拟机
虚拟化技术将一台物理计算机模拟为多台虚拟计算机
- **第一类虚拟机管理程序**（裸金属架构）直接控制硬件，虚拟机独立运行。
- **第二类虚拟机管理程序**（寄居架构）依赖宿主操作系统，虚拟机作为宿主操作系统的进程运行。