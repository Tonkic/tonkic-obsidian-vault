---
tags:
  - 操作系统
---
# (-)I/O 管理基础
## 1.设备
### 设备的基本概念
极限部件 + 电子部件(IO接口/IO控制器、设备控制器)
### 设备的分类
1. **抽象为文件**：
	- 在Unix系统中，所有外部设备（如硬盘、打印机等）都被抽象为特殊文件，用户可以像操作普通文件一样操作这些设备。
1. **按特性分类**：
    - **存储设备**：用于数据存储（如硬盘、U盘）。
    - **网络通信设备**：用于数据传输（如网卡）。
    - **人机交互设备**：与用户互动（如键盘、鼠标、显示器）。
2. **按信息交换单位分类**：
    - **块设备**：数据以块为单位传输，可以寻址（如硬盘）。
    - **字符设备**：数据以字符为单位传输，通常无法寻址，且常用中断驱动（如键盘、串口设备）。
3. **按设备共享属性分类**：
    - **独占设备**：一次只能由一个进程使用（如某些打印机）。
    - **共享设备**：多个进程可以共享使用（如磁盘）。
    - **虚拟设备**：通过SPOOLing技术使独占设备可共享（如虚拟打印机）。
### I/O接口（I/O控制器）
[总线和输入，输出系统 \> I/0接口(I/0控制器)](../计算机组成原理/总线和输入，输出系统.md#I/0接口(I/0控制器))
### I/O端口
- I/O控制器中的三种寄存器
- 可以与内存统一编址也可以独立编址
- 分别是：
	- 数据寄存器
	- 控制寄存器
	- 状态寄存器
	- 由于控制寄存器和状态寄存器使用时间上错开，有些I/O控制器将它们合二为一
## 2.I/O 控制方式
[总线和输入，输出系统 \> I/0方式](../计算机组成原理/总线和输入，输出系统.md#I/0方式)
### 轮询方式
### 中断方式
### DMA方式
## 3.I/0 软件层次结构
### 中断处理程序
- 接受中断信号（由硬件发出），进行中断处理
### 驱动程序
- 设备驱动程序
    - 设置设备寄存器、检查设备状态
    - 功能
        - 1 接收上层（设备独立软件）命令并翻译
        - 2 检查io合法性
        - 3 发出io命令
        - 4 发送设备控制命令（CPU控制IO设备时不需要中断，跳过中断处理程序）
### 设备独立软件
#### 为用户层软件提供系统调用的接口
- **输入/输出应用程序接口**：
    - **字符设备接口**：用于处理字符设备。
    - **块设备接口**：用于处理块设备。
    - **网络设备接口**（网络套接字接口）：用于网络通信，包含`bind`、`connect`、`read/write`等操作。
- **阻塞/非阻塞I/O**：区分用户进程是否因I/O操作而被阻塞（如`scanf`为阻塞操作）。
#### 设备保护
类似文件保护，权限方式
#### 差错处理
#### 设备分配与回收
- 使用LUT实现
	- **逻辑设备表(LUT)**：实现逻辑设备名与物理设备名的映射。
### 用户层 I/0软件
使用系统调用送信息到设备独立软件
## 4.输入/输出应用程序接口
[输入输出(I0)管理 \> 为用户层软件提供系统调用的接口](#为用户层软件提供系统调用的接口)
# (二)设备独立软件
## 1.缓冲区管理
#### 磁盘高速缓存
磁盘高速缓存（Disk Cache）利用内存存储磁盘数据的副本，加速磁盘I/O操作。访问内存中的缓存比直接访问磁盘更为高效。
- **缓存类型**：
    - 固定大小缓存：在内存中开辟一个专用区域作为缓存，大小固定。
    - 动态缓存池：未使用的内存空间作为共享缓冲池，支持分页系统和磁盘I/O请求。
####  缓冲区（Buffer
缓冲区的主要作用是缓解CPU与I/O设备之间的速度不匹配，减少中断频率，提高并行性。
- **缓冲区实现方式**：
    - **硬件缓冲器**：通常不普遍使用，成本高。
    - **内存缓冲区**：更常见，通过内存中的缓冲区提高效率。
#### 缓冲技术
- **单缓冲**：使用一个缓冲区，数据先存入缓冲区，I/O设备或处理机从中取数据。处理过程较为简单，但存在等待问题。
- **双缓冲**：使用两个缓冲区，设备填充一个缓冲区时，处理机可以处理另一个缓冲区的数据，从而提高并行性。
- **循环缓冲**：多个缓冲区组成环形结构，两个指针（in/out）控制数据的输入与输出，适用于高效的数据交换。
- **缓冲池**：由多个共享缓冲区组成，按使用状况分为不同队列，能有效管理数据流。
	- 用于收容输入数据的工作缓冲区
	- 用于提取输入数据的工作缓冲区
	- 用于收容输出数据的工作缓冲区
	- 用于提取输出数据的工作缓冲区
## 2.设备分配与回收
#### **设备分配时考虑的因素**
- **设备的固有属性**：
    - **独占设备**：一次只能被一个进程使用。
    - **共享设备**：多个进程可以并行使用。
    - **虚拟设备**：由系统模拟，不直接对应物理设备。
- **设备分配算法**：
    - **安全性考虑**：
	    - **安全分配方式**：每个进程一次只使用一个设备，避免死锁。缺点是进程无法并行执行CPU和I/O任务。
	    - **不安全分配方式**：允许进程同时使用多个设备，提高效率，但可能导致死锁。
	- **静态与动态分配**：
	    - **静态分配**：进程运行前分配所有设备，结束时归还。适用于独占设备。
	    - **动态分配**：进程在运行时动态申请资源，适用于共享设备。
	- **常用分配策略**：
	    - 先来先服务（FCFS）
	    - 最高优先级算法
#### **设备分配的步骤**
- 从物理设备名出发，通过 **SDT**、**DCT**、**COCT**、**CHCT** 进行设备的分配管理。
	- **通道控制表 (CHCT)**：每个通道一张，记录通道的操作和管理信息。
	- **控制器控制表 (COCT)**：每个控制器一张，记录设备控制器的信息。
	- **设备控制表 (DCT)**：每个设备一张，记录设备的使用情况（忙/等）
	- **系统设备表 (SDT)**：每个系统一张，记录系统中所有设备的总表。
#### **设备分配的改进方法**
- 通过逻辑设备名映射到物理设备名，并记录在 **LUT**（逻辑设备表）中，简化设备的管理。
## 3.假脱机技术(SPOOLing)
#### **脱机技术**
- **定义**：脱机技术指的是设备在与主机脱离直接控制的情况下进行输入/输出操作。
#### **假脱机技术（SPOOLing）**
- **概念**：假脱机技术是通过软件模拟脱机技术，使得I/O操作不再由CPU直接控制，而是通过外围控制机进行管理。
- **组成部分**：
    - **输入井与输出井**：数据存储在磁盘中，本质是文件队列
    - **输入缓冲区与输出缓冲区**：内存中的缓冲区，用于暂存数据。
- **工作原理**：
    - **输出过程**：用户进程产生输出数据，送入输出井，再由外围控制机传送到打印机等输出设备。
    - **输入过程**：输入设备（如键盘）将数据送入输入井，再通过外围控制机传输到用户进程。
## 4.设备驱动程序接口
系统对驱动程序的要求，必须使用规定的接口才能接入操作系统，为设备独立性软件提供服务
# (三)外存管理
## 1.磁盘
### 磁盘结构
- **磁盘**：由表面涂有磁性物质的圆形盘片组成，用于存储数据。
- **磁道**：每个盘片被划分为多个同心圆形的磁道，用于存储数据。
- **扇区**：每个磁道又被划分为若干扇区，是磁盘读写的最小单位，通常大小为512字节。
### 格式化
#### 1. **磁盘初始化**
- **低级格式化（物理格式化）**：为磁盘划分扇区
- **分区**：将磁盘划分为多个逻辑区域，每个区域可单独管理。
- **逻辑格式化**：创建文件系统，生成目录结构等，使磁盘能够存储文件数据。
#### 2. **引导块**
- **功能**：存储初始化程序（自举程序），用于启动计算机。
- **位置**：引导块位于磁盘的固定位置（通常是启动分区），包含完整的自举程序，确保计算机能够引导操作系统。
#### 3. **坏块管理**
- **简单磁盘**：在逻辑格式化时，标记坏块，避免使用这些扇区。
- **复杂磁盘**：磁盘控制器维护一个坏块链，并管理备用扇区，确保坏块不影响数据存储和访问。
### 分区
### 磁盘调度方法
#### 1. **先来先服务 (FCFS)**
- **概述**：按请求到达的顺序处理磁盘寻道请求。
- **优点**：实现简单。
- **缺点**：可能导致较长的平均寻道时间，效率低。
#### 2. **最短寻找时间优先 (SSTF)**
- **概述**：优先处理与当前磁头最近的磁道。
- **优点**：性能较好，平均寻道时间短。
- **缺点**：可能产生“饥饿”现象，某些磁道请求长时间得不到处理。
#### 3. **扫描算法 (SCAN)**
- **概述**：磁头在一个方向上一直移动，直到到达最边缘的磁道，然后改变方向，继续移动。
- **缺点**：只有到达最边上的磁道时才能改变磁头的移动方向。
#### 4. **LOOK 调度算法**
- **概述**：与扫描算法类似，但磁头在没有请求的情况下可以改变方向，而不必到达最边上的磁道。
- **优点**：提高了效率，避免了无请求的无意义移动。
#### 5. **循环扫描算法 (C-SCAN)**
- **概述**：磁头始终沿一个方向移动，若到达最边缘，则快速返回起始端，并继续处理请求。
- **缺点**：返回过程中不处理请求，可能造成部分请求延迟。
#### 6. **C-LOOK 调度算法**
- **概述**：类似于C-SCAN，但磁头只回到最靠近边上的磁道，而不需要到最边上。
- **优点**：效率更高，减少了不必要的磁头移动。
## 2.固态硬盘
#### 1. **原理**
- 基于闪存技术（Flash Memory），属于电可擦除ROM（EEPROM）。
#### 2. **组成**
- **闪存翻译层**：负责将逻辑块号转换为对应的物理页。
- **存储介质**：由多个闪存芯片（Flash Chip）组成，每个芯片包含多个块（Block），每个块包含多个页（Page）。
#### 3. **读写性能特性**
- 以**页**为单位进行读写，类似磁盘的“扇区”。
- 以**块**为单位进行擦除，擦除后可以写入新的数据。
- **随机访问**性能高，通过闪存翻译层迅速定位物理地址。
- **读快、写慢**，写入时需复制块内其他页到新的块，再写入新数据。
#### 4. **磨损均衡技术**
- **动态磨损均衡**：优先选择擦除次数少的闪存块进行写入，延长寿命。
- **静态磨损均衡**：自动监控并分配数据，让老旧块承担读任务，减少写入负担。