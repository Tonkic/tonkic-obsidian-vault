---
tags:
  - 计算机网络
---
# 数据链路层的功能
### 1. **为网络层提供服务**
- 服务类型
	- **无确认无连接**
	- **有确认无连接**
	- **有确认面向连接**
### 2. **链路管理**
### 3.**组帧**
- 将数据封装为帧，实现
	- 帧同步（区分帧的开始和终止）
	- 透明传输（数据无论如何组合都可传送）。
- **组帧方法**：
	- **字符计数法**：帧首部使用计数字段表示帧内字符数，易受攻击。
	- **字符填充法**：为避免数据与标志序列冲突，使用转义字符。
	- **零比特填充法**：连续5个0后添加一个0。
	- **违规编码法**：例如曼彻斯特编码头部和尾部就使用 高高/低低 两种在数据部分不会出现的字段 来界定边界，HDLC中5个连续1插0
### 3. **流量控制**
- 限制发送方的发送速率。
### 4. **差错控制**
- **检错编码**：
	- **奇偶校验**：
		- 奇校验：这串序列1的个数如果为偶数则在前面加个1，使1的个数变成奇数，否则加0。
	    - 偶校验：这串序列1的个数如果为奇数则在前面加个1，使1的个数变成偶数，否则加0。
	- **循环冗余码（CRC）**：
	- 双方约定一个多项式G（x）
	    - 如$x^3+x^2+1$表示1101
	- 要传输的数据后面加0
	    - G（x）的阶为r，就加r个0
        - 如$x^3+x^2+1$ 3阶，要传输1101011->1101011000
- 对数据使用模2除法
    - 得到的余数做完FCS加在数据后
    - 模二除不进位不借位，相当于异或
	    - 如1101011 000除1101得1000010余100
	    - 就把100加到最后得到1101011 100发送
	    - 接收方收到数据后，如果1101011 100除1101余0则认为正确
- **纠错编码**：
	- **海明码**：可纠正1位错误，检测2位错误，使用校验位定位错误位。
	- n为有效信息位数，k为检验位位数，$n+k\leq 2^k -1$
		- - `2^k` 表示：`k` 个校验位对应 `2^k` 种状态
		- `n + k + 1` 表示：`n + k` 代表任何一位都可能出错，`1` 代表一种正确的状态
		- 比如数据位8位，就是n=8，代入得到k至少为4
	- 为了检测e个位错，海明距离至少为e+1。
	- 为了纠正t个位错，海明距离至少为 2t+1。
	- 海明距离：字符串之间不同的位数
# 组帧
[数据链路层 \> 3.\*\*组帧\*\*](#3.**组帧**)
# 差错控制
[数据链路层 \> 4. \*\*差错控制\*\*](#4.%20**差错控制**)
# 流量控制与可靠传输机制
## 1. 流量控制、可靠传输与滑动窗口机制
流量控制用于调节发送方的发送速率，防止接收方处理不及导致数据丢失
## 2. 停止-等待协议
在停止-等待协议中，发送方每发送一个帧，必须等待接收方的确认（ACK）后才发送下一个帧。
- **无差错情况**：数据帧成功传输，接收方及时回复确认。
- **有差错情况**：如果数据帧丢失或出错，接收方不发送确认信号，发送方会超时重发。若ACK丢失，发送方会重发确认。
## 3. 后退N帧协议 (GBN)
GBN是滑动窗口协议的一个例子，其中发送方和接收方各自维护一个滑动窗口。发送方可以在窗口内同时发送多个帧，但只允许按顺序确认。
- **滑动窗口的长度** $- 1 \leq W \leq 2^n - 1$
        - W滑动窗口长度
        - n是n个比特对帧编号
- **接收窗口长度**为1
- **累计确认**：接收方可以累计确认，意味着接收到多个帧后只返回一个确认，表示所有前面的帧都已正确接收。
- **必须顺序接收**：接收方按顺序接收帧，不会接受乱序的帧（如果接收方期望的是帧3，但收到的是帧4，则丢弃帧4并一直等待帧3）。
## 4. 选择重传协议 (SR)
- **发送方**：发送方根据接收方的反馈只重发出错的帧。
- **接收方**：接收方在接收到错误帧时发送NAK请求，要求重发该帧。
**滑动窗口长度**：
- 发送窗口的长度通常等于接收窗口的长度。
- 设定条件： $W_r + W_t \leq 2^n$，其中 $W_r$ 是接收窗口，$W_t$ 是发送窗口，且 $W_r \leq W_t$，不然接收窗口填不满，多出来的无用.
### 信道利用率
信道利用率表示在一个发送周期内有效传输数据的时间占总时间的比率，公式为：  
$\text{信道利用率} = \frac{L}{C} \times \frac{1}{T}$
其中：
- ( L ) 是传输的数据量（比特），
- ( C ) 是传输速率，
- ( T ) 是发送周期，是从发送数据到接收到第一个确认帧所需要的总时间，包括发送方的发送时延、往返时延（RTT）以及接收方确认分组的发送时延。
# 介质访问控制
## 1.信道划分
1. **频分多路复用 FDM**：每个设备在自己分配的频段上进行通信，成熟且效率高。
2. **时分多路复用 TDM**：将时间划分为多个时隙，设备在各自的时隙内发送数据。其改进形式——统计时分复用（STDM），根据实际需求动态分配时隙，提高了带宽利用率。
3. **波分多路复用 WDM**：在光通信中，通过将光信号在不同波长上传输，进行频分多路复用。
4. **码分多路复用 CDM**（或码分多址 CDMA）：使用正交码对设备进行区分，收到码片序列正交后，1发送1，0表示没发送数据，-1表示发送0
		例：
		A:(-1 -1 -1 +1 +1 -1 +1 +1) B:(-1 -1 +1 -1 +1 +1 +1 -1)
		C:(-1 +1 -1 +1 +1 +1 -1 -1) D:(-1 +1 -1 -1 -1 -1 +1 -1)
		现收到这样的码片序列:( +1 -3 +3 -1 +1 +1 +1 +1)
		A：-1+3-3-1+1-1+1+1=0 ，A站点没有发送数据。
		B：1/8(-1+3+3+1+1+1+1-1)=1，表示B站发送的信息是+1。
		C：1/8(-1-3-3-1+1+1-1-1)= -1，表示C站发送的信息为0。
		D：1/8(-1-3-3+1-1-1+1-1)=-1，表示D站发送的信息为0。
## 2.随机访问
1. **ALOHA 协议**：
    - **纯 ALOHA**：发送方在任何时刻发送数据，冲突时超时重传。
    - **时隙 ALOHA**：时间分成固定时隙，冲突发生后等下一个时隙开始时重传。
2. **CSMA 协议**（载波监听多路访问）：
    - **CS**：发送前监听信道。
    - **MA**：允许多个设备接入。
    - 分类：
        - **1-坚持 CSMA**：信道空闲时立即发送，忙时继续监听。
        - **非坚持 CSMA**：信道空闲时发送，忙时等待随机时间后再监听。
        - **p-坚持 CSMA**：根据信道状态的概率继续监听。
3. **CSMA/CD 协议**（载波监听多点接入/碰撞检测）：
    - 发送前和发送中监听信道。
    - 只要经过 2τ 时间还没有检测到碰撞，此次发送一定不会发生碰撞
    - 截断二进制指数规避算法
	    - 重传次数 k
	        - k = min（重传次数，10）
	    - 重传需要的退避时间= r\*2τ
	        - 0 < r < $2^k -1$，中取随机数,上限1023
	    - 重传达到 16次 仍然失败。抛弃此帧，向上层报告错误
    - 最小帧长问题
	    - 如果帧过短，还没检测到冲突，数据帧就发送完毕
	    - 最小帧长 对应的 发送时延 要 大于 2τ
	    - 帧长/数据传输速率>=2RTT（RTT≈链路长度/信号传播速率）
1. **CSMA/CA 协议**（载波监听多点接入/碰撞避免）：
    - 应用于无线局域网（如Wi-Fi）。
    - **帧间间隔（IFS）**：包括SIFS<PIFS<DIFS ；小SPD大

| **发送方**                                           | **接收方**                          |
| ------------------------------------------------- | -------------------------------- |
| 监听信道，等待空闲DIFS时间后，发送RTS（请求发送），包含发射端地址、接收端地址、数据持续时间 |                                  |
|                                                   | 收到RTS，并等待SIFS时间，发送CTS            |
| 收到CTS后，等待SIFS时间，开始发送数据帧，并预约信道                     |                                  |
|                                                   | 接受数据帧并通过CRC验证校验其正确性，若数据正确，则发送ACK |
| 收到ACK帧后，发送下一帧，若未收到ACK，则使用二进制指数退避算法重传数据            |                                  |
## 3.轮询访问
### 令牌传递协议
- 令牌
    - 一个特殊格式的MAC控制帧，不含任何信息
    - 控制信道的使用，确保同一时刻只有一个结点独占信道
- 令牌持有时间有上限，不能无限制长时间持有令牌
- 适用于负载较重、通信量较大的网络中
# 局域网
## 1.局域网的基本概念与体系结构
### 局域网
- **使用广播信道**：局域网通过广播信道进行通信。
- **数据传输率**：10Mb/s到10Gb/s。
- **通信方式**：采用分布式控制和广播式通信，支持广播和组播。
### 分层
- **LLC子层（逻辑链路控制子层）**：识别网络层协议并进行封装，为网络层提供服务。
- **MAC子层（介质访问控制子层）**：
    - 负责数据帧的封装与解封装。
    - 进行帧寻址、识别、接收、发送、管理和差错控制。
    - 屏蔽不同物理链路的差异性。
## 2. 以太网与 IEEE 802.3
- **标准**：IEEE 802.3，使用CSMA/CD协议。
- **功能**：无差错接收，不实现可靠传输。
- **拓扑结构**：逻辑上总线型，物理上星型。
- **编码**：使用曼切斯特编码（上下）
- **相关概念**：
    - **适配器**：网卡，进行数据串并转换。
    - **MAC地址**：48位物理地址，前24位为厂家地址，后24位为厂家自定义
    - **MAC帧**：数据部分46-1500字节，FCS校验（使用CRC-32得到），帧无需结束定界符。因为最小帧长64B，64-6-6-2-4=46B

| 8B                         | 6B   | 6B  | 2B                  | 46-1500B | 4B  |
| -------------------------- | ---- | --- | ------------------- | -------- | --- |
| 前导码=<br>7B同步用+<br>1B帧开始界定符 | 目的地址 | 源地址 | 类型<br>IPV4/6<br>ARP | 数据       | FCS |

## 3. IEEE 802.11无线局域网
- **标准**：IEEE 802.11，使用CSMA/CA协议。
- **MAC帧头结构**：（源地址在无线桥接下才使用）

| 2B  | 2B   | 6B  | 6B  | 6B   | 2B   | 6B  | 4B  |
| --- | ---- | --- | --- | ---- | ---- | --- | --- |
| 帧控制 | 生存周期 | 接收端 | 发送端 | 目的地址 | 序列控制 | 源地址 | FCS |
- **MAC帧主体和帧尾结构**：

| 0-2312B | 4B  |
| ------- | --- |
| 数据      | FCS |

## 4. VLAN 基本概念与基本原理
- 在以太网帧的源地址和类型中间插入VLAN标签
- VLAN标签
    - 长四字节
    - 前两个字节为0x8100表示这是802.1Q帧
    - 后两个字节的后12位为VID表示帧属于哪个VLAN
# 广域网
## 1.广域网的基本概念
- 通常跨越很大的物理范围、几十公里到几千公里。跨国、跨洲
## 2.PPP协议
- **全双工链路**：只支持全双工通信。
- **组成部分**：
    - **链路控制层协议（LCP）**：负责身份验证，建立和维护数据链路连接。
    - **网络控制协议（NCP）**：支持多种网络层协议，每种协议使用对应的NCP来配置并建立逻辑连接。
- **帧格式**：帧开始+地址+控制+协议（指明数据如何解读）+FCS+帧结束
# 数据链路层设备
- **网段**：同一物理层设备下，能够直接通信的网络部分。一个网段属于一个冲突域。
- **网桥**：根据MAC地址转发和过滤帧。
    - **透明网桥**：不影响站点，站点不知道经过的网桥。
    - **源路由网桥**：帧头包含路由信息。
- **以太网交换机**（多接口网桥）：
    - **直通式交换机**：根据==目的地址==直接转发，优点是延迟小，但可靠性低，且不支持不同速率端口交换。
    - **存储转发式交换机**：检查帧是否正确，错误丢弃，优点是可靠性高，支持不同速率端口交换，但延迟大。
- **冲突域**：同一时间只能有一台设备发送信息的范围。
- **广播域**：广播信号可被所有设备接收的范围。
### 设备说明
- **中继器**：增强基带信号，传输模拟信号。
- **放大器**：增强宽带信号，传输数字信号。
- **集线器**：共享式以太网。
- **交换机**：交换式以太网。